entry_state_conditions:
  - is_none: state.User__FavoritePlace

# THESE ARE EVALUATED AT THE PROMPT STAGE
prompts:
- prompt_name: favorite_place
  prompt_text: "What's your favorite city?"

# THESE ARE EVALUATED AT THE GENERATION STAGE
# entry_conditions_takeover:
#   - is_true: GLOBAL__user_has_navigational_intent

# continue_conditions:
#   - is_true: flags.PLACES__user_mentioned_place

locals:
  intro_statement: # Ah yes, potatoes are one of my favorite things to eat up here...
    - one of: 
      - Oh! 
      - Cool!
      - Awesome!
    - val: utilities.cur_entity_talkable_lower
    - inflect:
        inflect_token: is
        inflect_entity: utilities.cur_entity
    - one of:
      - is one of my favorite cities to visit.
      - such an amazing choice. It's one of my favorite cities too!
    
set_state:
  state.User__FavoritePlace:
    - val: utilities.cur_entity
  state.User__FavoritePlaceTalkable:
    - val: utilities.cur_entity_talkable_lower
  state.User__FavoritePlacePopulation:
    - nlg_helper:
      name: get_city_population
      args:
        - val: utilities.cur_entity_name
  state.User__FavoritePlaceLanguagesSpoken:
    - nlg_helper:
      name: get_city_language
      args:
        - val: utilities.cur_entity_name

  
subnodes:
  # This one shouldn't be necessary bc we only activate if the user mentions a food entity.
  # - node_name: entity_not_found
  #   entry_conditions:
  #     is_true: flags.no_food_entity_found
  #   response: ''
  #   needs_prompt: True
  #   state_updates:
  #     no_entity: True
  #   exit: True

  - node_name: make_city_weather_comment
    entry_conditions:
      - is_not_none: state.User__FavoritePlace
    response:
      - val: locals.intro_statement
      - Personally, I especially like the weather there.

  # I especially love how it's [NEURAL_GEN]...
  - node_name: default
    response: 
    - val: locals.intro_statement
    - neural_generation:
        prefix: 
          - I especially love
          - inflect:
              inflect_token: it's
              inflect_entity: utilities.cur_entity

set_state_after:
  flags.GlobalFlag__LastBotTurnWasOpenEnded:
    constant: True
